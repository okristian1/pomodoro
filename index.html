<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Pomodoro Clock</title>
    <meta name="description" content="${2}">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
    <link rel="stylesheet" href="main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

</head>
<body>

<header>
  <div class="container-fluid text-center">
    <h1>FreeCodeCamp Pomodoro Clock</h1>
  </div>
</header>

<div class="container text-center">
<div class="row">
  <hr />
    <div class="col-md-2 col-md-offset-4">
        <h3>Session length</h3>
        <button class="btn btn-lg btn-default pull-right"  id="plusSession">+</button>
        <button class="btn btn-lg btn-default pull-left" id="minusSession">-</button>
        <h2 id=session-length>2</h2>
    </div>
    <div class="col-md-2">
        <h3>Break length</h3>
        <button class="btn btn-lg btn-default pull-right" id="plusBreak">+</button>
        <button class="btn btn-lg btn-default pull-left" id="minusBreak">-</button>
        <h2 id="break-length">1</h2>
    </div>
</div>
<hr />
<button class="btn btn-default start">Start</button>
<button class="btn btn-default resetTimer">Reset</button>
</div>

<div class="container">
      <div class="col-md-10 col-md-offset-1">
        <div class="counter center-block" id="counter">
          <p class="counter-header text-center" id="counter-header">Session</p>
          <p class="counter-timer text-center" id=counter-timer>
          <span class="minute">2</span> : <span class="second">00</span>
          <br />
        </p>
        <div class="animate">
        </div>
      </div>
    </div>
</div>

<!-- Disabled because doesnt work on github pages anyway
    <script src="main.js" async defer></script>
-->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.4.min.js"><\/script>')</script>
    <script>
        window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
        ga('create','UA-XXXXX-Y','auto');ga('send','pageview')
    </script>
    <script src="https://www.google-analytics.com/analytics.js" async defer></script>
    <script>
    var plusSession = document.querySelector('#plusSession');
    var minusSession = document.querySelector('#minusSession');
    var sessionTime = document.querySelector('#counter-timer');
    var sessionLength = document.querySelector('#session-length');
    var plusBreak = document.querySelector('#plusBreak');
    var minusBreak = document.querySelector('#minusBreak');

    var start = document.querySelector('.start');


    var breakLength = document.querySelector('#break-length');
    var clock = document.getElementById('.counter-timer');
    var minuteSpan = document.querySelector('.minute');
    var secondSpan = document.querySelector('.second');

    var counterHeader = document.querySelector('#counter-header');
    var resetTimer = document.querySelector('.resetTimer');

    var animation = document.querySelector('.animation');

    var relax = false;
    var running = false;

    plusSession.onclick = function plusSessionTime() {
      if(!running) {
        sessionLength.innerHTML++;
        minuteSpan.innerHTML++;
      }
    }
    minusSession.onclick = function minusSessionTime() {
      if(!running) {
        sessionLength.innerHTML--;
        minuteSpan.innerHTML--;
      }
    }
    plusBreak.onclick = function plusBreakTime() {
      if(!running) {
        breakLength.innerHTML++;
      }
    }
    minusBreak.onclick = function minusBreakTime() {
      if(!running) {
        breakLength.innerHTML--;
      }
    }

    // Make clock
    function getTimeRemaining(endtime) {
      var t = Date.parse(endtime) - Date.parse(new Date());
      var seconds = Math.floor( (t/1000) % 60 );
      var minutes = Math.floor ( (t/1000/60) % 60 );
      return {
        'total': t,
        'minutes': minutes,
        'seconds': seconds
      };
    }

    function addZero(i) {
      if(i < 10) {
        i = "0" + i;
      }
      return i;
    }


    function initializeClock(id, endtime) {
      var clock = document.getElementById(id);
      var minuteSpan = clock.querySelector('.minute');
      var secondSpan = clock.querySelector('.second');
      var timeinterval = setInterval(updateClock,1000);

      resetTimer.onclick = function reset() {
        var deadline = new Date(Date.parse(new Date()) + sessionLength.innerHTML*60*1000);
        minuteSpan.innerHTML = sessionLength.innerHTML;
        secondSpan.innerHTML = '00';
        $('.animate').animate({ marginTop: '100%'}, {duration: 500, easing: 'linear'}).fadeOut();
        $('.animate').stop();
        $('.animate').clearQueue();
        resetTimer.disabled = true;
        clearInterval(timeinterval);
        running = false;
        }


      function updateClock() {
        var t = getTimeRemaining(endtime);
        t.seconds = addZero(t.seconds);
        t.minutes = addZero(t.minutes);

        minuteSpan.innerHTML = t.minutes;
        secondSpan.innerHTML = t.seconds;
        if (t.total <= 0) {
          if (relax === false) {
          clearInterval(timeinterval);
          var deadline = new Date(Date.parse(new Date()) + Math.floor((breakLength.innerHTML*1000) * 60 ));
          initializeClock('counter-timer', deadline);
          counterHeader.innerHTML = "Break";
          $('.animate').animate({ marginTop: '100%'}, {duration: Math.floor((breakLength.innerHTML*1000) * 60 ), easing: 'linear'});
          clearInterval(timeinterval);
          relax = true;
        }
        else {
          var deadline = new Date(Date.parse(new Date()) +  Math.floor((sessionLength.innerHTML*1000) * 60 ));
          clearInterval(timeinterval);
          initializeClock('counter-timer', deadline);
          counterHeader.innerHTML = "Session";
          $('.animate').animate({ marginTop: '0px'}, {duration: Math.floor((sessionLength.innerHTML*1000) * 60 ), easing: 'linear'});
          clearInterval(timeinterval);
          relax = false;
        }
      }
    }

    }
    window.onload = function(){
        start.onclick=function(){
          if(!running) {
            var deadline = new Date(Date.parse(new Date()) + sessionLength.innerHTML*60*1000);
            initializeClock('counter-timer', deadline);
            $('.animate').animate({ marginTop: '0px'}, {duration: sessionLength.innerHTML*60*1000, easing: 'linear'});
            running = true;
            resetTimer.disabled = false;
          }
        }
      }

    </script>

</body>
</html>
